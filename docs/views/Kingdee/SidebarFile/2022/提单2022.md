---
title: '2022年提单复盘'
date: 2022-01-10
categories:
- "Kingdee"
tags:
- 工作笔记
isFull: false 
sidebar: true
isShowComments: true
isShowIndex: false
---

## 提单分析  

<span style="font-size:22px;">共计47个</span>

- 第4周(1.24-1.29) 12

    R20220124-3239，R20220114-0472，R20220125-0809，R20220122-1174，R20220122-1326，R20220126-2593，R20220126-2751，R20220126-1866，R20220128-1411

    1. **R20220120-0826**：客户是多组织模式，物料创建的时候，想实现A组织创建物料发料方式默认用调拨倒冲，B组织创建物料默认用直接倒冲，如何设置。

    ![](https://image.xjq.icu/2022/2/18/1645172699193_materialconfig.png)

    2. **R20220122-1104**：客户反馈由于物料过多需要设置物料名称+规格型号拼接的形式在物料列表中进行模糊查询，例如物料名称ABC，规格型号123，客户想直接输入AB12然后查询出名称包含AB，规格型号包含12的物料，

    ```python
    # 新增一个物料按名称+规格型号拼接，保存后刷新此字段，列表按照新增的字段查询
    def BeginOperationTransaction(e):
	materialDatas=e.DataEntitys
	for item in materialDatas:
		name=item['Name']
		currentName=name[this.Context.UserLocale.LCID]
		specification=item['Specification']
		currentSpecification=specification[this.Context.UserLocale.LCID]
		item['Texts']=currentName+'_'+currentSpecification

    # 更新历史数据
    update a set a.FTEXT=b.fname+'_'+b.FSPECIFICATION  from t_bd_material a 
    inner join t_bd_material_l b on a.fmaterialid=b.fmaterialid
    where b.flocaleid=2052
    ```

    3. **R20220124-0770**：生产用料清单下推生产领料单后，在库存查询-选择多个批号的库存进行返回数据后，申请数量也会一起返回。客户想要实现类似销售出库单的返回数据，应发数量不会重复。

    ![](https://image.xjq.icu/2022/2/18/1645172699192_pickmtrl.png)
    ![](https://image.xjq.icu/2022/2/18/1645172699192_saleoutstock.png)

    **原因**：库存查询供应链那边代码里使用了行复制，想要不复制申请数量，在bos中把申请数量功能控制中允许复制去掉勾选即可

- 第3周(1.17-1.23) 15

    R20220114-1724，R20220114-4230，R20220114-0588，R20220117-347，R20220118-3926，R20220117-0736，R20220118-0999， R20220117-4226，R20220121-0886，R20220120-1032，R20220110-2248 

    1. **R20211223-2674**：物料清单批量维护，变更子项，模拟列表显示正常，最后一步处理结果提示成功，进度走到100%，更是没有但没有具体明细且检查BOM并没有修改成功。

    **原因**：实际物料清单保存失败，未显示保存错误信息，导致进度条到100%，但未有具体执行执行明细

    2. **R20220117-3732**：通过配置的方式获取即时库存

    ![](https://image.xjq.icu/2022/1/24/1642988529978_kucun.png)

    3. **R20220113-2175**：生产订单下推工序汇报单，生产入库单反写生产订单数量出错(下推工序汇报后的反写是北研那边处理的，生产入库单和生产订单之间的单据关联关系已断掉)

    4. **R20220120-3365**：审批流中配置上查操作

    ![](https://image.xjq.icu/2022/1/24/1642989031212_flow.png)


- 第2周(1.10-1.16) 11

    R20220106-5216，R20220104-3676，R20220108-0529，R20220111-0847，R20220107-4109，R20220106-4336，R20220110-4653，R20220108-0736

    1. **R20220105-3134**：物料清单分配提升成功，但是子项没分配过去

    **原因**：树形维护业务操作中的分配，只是单个物料清单的分配，不是整个BOM树的分配，如果想整个BOM树的分配，需要用批量分配

    **解决方案**：在bom树形维护使用批量分配，即可把子项物料对应的bom进行分配

    2. **R20220110-1140**：WebApi接口，可以允许传入忽略交互的参数标志，具体参数 InterationFlags：交互标志集合，字符串类型，分号分隔，格式"flag1;flag2;..."（非必录）

    **解决方案**："IgnoreInterationFlag"这个属性传个true交互式相当于默认就点了是

    3. **R20220110-3335**：webapi方式新增物料传入图片

    ![](https://image.xjq.icu/2022/1/17/1642386698577_materialImage.png)

- 第1周(1.04-1.09) 9

    R20220102-0193，R20211230-0079，R20211230-3201,R20211229-4568 ,R20211230-0453，R20220103-1020，R20220106-4627，R20220107-0252

    1. **R20220103-0030**：想要实现有报表可以按照bom多级展开查看物料的可用量，即即时库存-预计出+预计入的数量，调用预计可发量接口

    **解决方案**：新建类继承TreeBomQueryForward，重写RefreshEntityView()方法，在此方法中遍历物料清单正查结果数据包bomQueryChildItems，根据此数据包中物料的信息调用获取预计可发量接口得到可用量信息填充至物料清单正查数据包对应属性，刷新界面；在物料清单正查上取消原本插件，注册上二开插件即可。

    [获取预计可发量接口参考帖子](https://vip.kingdee.com/article/3763)
    [物料清单正查二开参考帖子](https://vip.kingdee.com/article/137580948630829824)